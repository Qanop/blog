{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/map-all-aws-resources-and-make-a-vulnerability-report-using-cloudmapper","result":{"data":{"markdownRemark":{"id":"8bb9dce0-3965-5933-bccd-e938ed38493d","html":"<p>Last time I remembered about a tool that allows you to create a big map of current resources present in your AWS account, and based on it make a report of potential vulnerabilities, threats, unused resources and much more. I can thank a colleague at work for finding it - such explorers are a real treasure!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0c1a52aeacc5dcaf5e0da19a48c4350d/47311/server-3.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFBP/EABcBAAMBAAAAAAAAAAAAAAAAAAECAwT/2gAMAwEAAhADEAAAAZw3VXPOGAb/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQIDEUH/2gAIAQEAAQUClEVePcEcP//EABcRAQADAAAAAAAAAAAAAAAAAAABERL/2gAIAQMBAT8B1K3/xAAXEQEAAwAAAAAAAAAAAAAAAAAAAQIR/9oACAECAQE/AYqx/8QAGBAAAwEBAAAAAAAAAAAAAAAAABCBETH/2gAIAQEABj8C1cKRf//EABwQAAIBBQEAAAAAAAAAAAAAAAABESExQWFxUf/aAAgBAQABPyGaiOoqitowNFpmYYe9P//aAAwDAQACAAMAAAAQf+//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPxCA/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAh/9oACAECAQE/EATZn//EAB4QAQACAgIDAQAAAAAAAAAAAAEAESExcbFBYYHw/9oACAEBAAE/EK6KF2Xn1cVAVvhlrdTK1VwDZN+Lufj8hvk7n//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/0c1a52aeacc5dcaf5e0da19a48c4350d/8ac56/server-3.webp 240w,\n/static/0c1a52aeacc5dcaf5e0da19a48c4350d/d3be9/server-3.webp 480w,\n/static/0c1a52aeacc5dcaf5e0da19a48c4350d/e46b2/server-3.webp 960w,\n/static/0c1a52aeacc5dcaf5e0da19a48c4350d/260c2/server-3.webp 1080w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/0c1a52aeacc5dcaf5e0da19a48c4350d/09b79/server-3.jpg 240w,\n/static/0c1a52aeacc5dcaf5e0da19a48c4350d/7cc5e/server-3.jpg 480w,\n/static/0c1a52aeacc5dcaf5e0da19a48c4350d/6a068/server-3.jpg 960w,\n/static/0c1a52aeacc5dcaf5e0da19a48c4350d/47311/server-3.jpg 1080w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/0c1a52aeacc5dcaf5e0da19a48c4350d/6a068/server-3.jpg\"\n          alt=\"Map all AWS resources and make a vulnerability report using cloudmapper\"\n          title=\"Map all AWS resources and make a vulnerability report using cloudmapper\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>The <a href=\"https://github.com/duo-labs/cloudmapper\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">duolabs/cloudmapper</a> repository is responsible for scanning and mapping resources on the current user account. It is a great tool to see our mistakes when releasing the environment or purging the client account of unused, often manually created resources. Using the program is best done with building and using a docker image.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone https://github.com/duo-labs/cloudmapper.git\ndocker build -t cloudmapper <span class=\"token builtin class-name\">.</span>\n\n<span class=\"token assign-left variable\">AWS_PROFILE</span><span class=\"token operator\">=</span>default\ndocker run -it <span class=\"token punctuation\">\\</span>\n        -e <span class=\"token assign-left variable\">AWS_ACCESS_KEY_ID</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws configure get aws_access_key_id --profile $<span class=\"token punctuation\">{</span>AWS_PROFILE<span class=\"token punctuation\">}</span><span class=\"token variable\">)</span></span> <span class=\"token punctuation\">\\</span>\n        -e <span class=\"token assign-left variable\">AWS_SECRET_ACCESS_KEY</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>aws configure get aws_secret_access_key --profile $<span class=\"token punctuation\">{</span>AWS_PROFILE<span class=\"token punctuation\">}</span><span class=\"token variable\">)</span></span> <span class=\"token punctuation\">\\</span>\n        -p <span class=\"token number\">8000</span>:8000 <span class=\"token punctuation\">\\</span>\n        cloudmapper /bin/bash</code></pre></div>\n<p>Then run this command inside docker shell <code class=\"language-text\">aws sts get-caller-identity</code> to get data about your running account. </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"UserId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"JNSNATUSNPWEBAA8HNAPE\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Account\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"830572105813\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Arn\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:iam::830572105813:user/project-env\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>After confirming right data, pass your <code class=\"language-text\">UserId</code> into <code class=\"language-text\">YOUR_ACCOUNT_NUMBER</code> field in first command below\n(check also <a href=\"https://github.com/duo-labs/cloudmapper#commands\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">additional report commands</a> for unused resources or IAM data)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">python cloudmapper.py configure add-account --config-file config.json --name YOUR_ACCOUNT --id YOUR_ACCOUNT_NUMBER\npython cloudmapper.py collect --account YOUR_ACCOUNT\npython cloudmapper.py report --account YOUR_ACCOUNT\npython cloudmapper.py prepare --account YOUR_ACCOUNT\npython cloudmapper.py webserver --public</code></pre></div>\n<p>After successful data fetch, you can find your results on those links:</p>\n<ul>\n<li><a href=\"http://localhost:8000/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Resource Map - localhost:8000/</a></li>\n<li><a href=\"http://localhost:8000/account-data/report.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Report - localhost:8000/account-data/report.html</a></li>\n</ul>\n<p>You can find examples of fetched AWS accounts under those links: </p>\n<ul>\n<li><a href=\"https://duo-labs.github.io/cloudmapper/account-data/report.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Report</a></li>\n<li><a href=\"https://duo-labs.github.io/cloudmapper/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Resource Map</a></li>\n<li><a href=\"https://github.com/duo-labs/cloudmapper/blob/main/auditor/README.md\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">daily auto-audits with Slack notifications</a></li>\n</ul>","fields":{"slug":"/posts/map-all-aws-resources-and-make-a-vulnerability-report-using-cloudmapper","tagSlugs":["/tag/technology/","/tag/ops-dev-ops/"]},"frontmatter":{"date":"2022-01-28T21:11:38.000Z","description":"Last time I remembered about a tool that allows you to create a big map of current resources present in your AWS account, and based on it make a report of potential vulnerabilities, threats, unused resources and much more. I can thank a colleague at work for finding it - such explorers are a real treasure!","tags":["Technology","Ops / DevOps"],"title":"Map all AWS resources and make a vulnerability report using cloudmapper","socialImage":"media/server-3.jpg"}}},"pageContext":{"slug":"/posts/map-all-aws-resources-and-make-a-vulnerability-report-using-cloudmapper"}},"staticQueryHashes":["1797451822","251939775","401334301"]}