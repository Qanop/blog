{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/magic-of-whiptail-squid-proxy-instalation","result":{"data":{"markdownRemark":{"id":"7f6789ea-3e26-500b-abbb-83ee619543fb","html":"<p>When installing a bash open source project, I was always full of admiration for the developers who implemented the graphical interface. I was curious how it works and how I could apply it to my projects. The solution is simple. It is the whiptail.</p>\n<h2 id=\"whiptail\" style=\"position:relative;\"><a href=\"#whiptail\" aria-label=\"whiptail permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>whiptail</h2>\n<p>Whiptail is one of the popular programs that allows you to display dialog boxes in the shell. Proper preparation of steps and good ability to write shell scripts allows you to skillfully extract a lot of information from it and use it to build automated scripts.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/000c3d3fbfd1f05ba679b9f2342afb08/47311/server-4.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB5FcrDmIR/8QAGxABAAAHAAAAAAAAAAAAAAAAAQAEEBITMkH/2gAIAQEAAQUCtiXDJ11Kf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABoQAAICAwAAAAAAAAAAAAAAAAABEBEhMYH/2gAIAQEABj8Czotwjkf/xAAcEAEAAQQDAAAAAAAAAAAAAAABACExQXERUbH/2gAIAQEAAT8h7I0zDBgOMxqmt54JYbRxP//aAAwDAQACAAMAAAAQuD//xAAXEQEAAwAAAAAAAAAAAAAAAAABEBEh/9oACAEDAQE/EErY/8QAFhEBAQEAAAAAAAAAAAAAAAAAAREQ/9oACAECAQE/EBrM/8QAHhABAAIBBAMAAAAAAAAAAAAAAQARQRAhMbFxocH/2gAIAQEAAT8QCFICjKCdJc6ySlUrTt5nrdHSnV9n/9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/000c3d3fbfd1f05ba679b9f2342afb08/8ac56/server-4.webp 240w,\n/static/000c3d3fbfd1f05ba679b9f2342afb08/d3be9/server-4.webp 480w,\n/static/000c3d3fbfd1f05ba679b9f2342afb08/e46b2/server-4.webp 960w,\n/static/000c3d3fbfd1f05ba679b9f2342afb08/260c2/server-4.webp 1080w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/000c3d3fbfd1f05ba679b9f2342afb08/09b79/server-4.jpg 240w,\n/static/000c3d3fbfd1f05ba679b9f2342afb08/7cc5e/server-4.jpg 480w,\n/static/000c3d3fbfd1f05ba679b9f2342afb08/6a068/server-4.jpg 960w,\n/static/000c3d3fbfd1f05ba679b9f2342afb08/47311/server-4.jpg 1080w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/000c3d3fbfd1f05ba679b9f2342afb08/6a068/server-4.jpg\"\n          alt=\"Basic functions of whiptail\"\n          title=\"Basic functions of whiptail\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>The basic program boxes include</p>\n<ul>\n<li>message box</li>\n<li>yes / no box</li>\n<li>input box</li>\n<li>password box</li>\n<li>text box</li>\n<li>menu</li>\n<li>check list</li>\n<li>radio letter</li>\n<li>progress gauge</li>\n</ul>\n<p>So as you can see, we can ask the user for all his requirements for running the script.</p>\n<h2 id=\"squid--install-proxy-server-in-few-simple-steps\" style=\"position:relative;\"><a href=\"#squid--install-proxy-server-in-few-simple-steps\" aria-label=\"squid  install proxy server in few simple steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Squid — install proxy server in few simple steps</h2>\n<p>Squid is a great program for creating a proxy server. It allows you to control the flow of information, maintain access at a specific time, manage access for users or bind specific network cards to appropriate ports and more. It is a very efficient tool and its configuration at a basic level does not require much time. Therefore, recently I installed this server on one of my VPS to get to specific sources by passing my data over other IP. Of course, while it takes a few steps to install, it’s always nice to have an automated task. Therefore, I created the base code using dialog boxes. In order not to take too much space on the article, it is also slimmed down with additional validation of variables and function results. After all, the code is designed to encourage work.</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">#!/bin/bash\n\nwhiptailInputBox() {\n    # Open window with text input\n\n    # Parameters:\n    #   $1 Box title\n    #   $2 Content\n    #   $3 Default\n\n    RESULT=`whiptail --inputbox &quot;$2&quot; 8 78 $3 --title &quot;$1&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3`\n    return $?\n    echo $RESULT\n}\n\nwhiptailPasswordBox() {\n    # Open window with password input\n\n    # Parameters:\n    #   $1 Box title\n    #   $2 Content\n    #   $3 Default\n\n    echo `whiptail --passwordbox &quot;$2&quot; 8 78 $3 --title &quot;$1&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3`\n    return $?\n    echo $RESULT\n}\n\nwhiptailMessageBox() {\n    # Open window as message box \n\n    # Parameters:\n    #   $1 Box title\n    #   $2 Content\n    \n    whiptail --title &quot;$1&quot; --msgbox &quot;$2&quot; 8 78\n}\n\npreinstall() {\n    if ! [ -x &quot;$(command -v whiptail)&quot; ]; then\n        /usr/bin/apt update\n        /usr/bin/apt -y install whiptail\n    fi\n}\n\ninstall_squid() {\n    /usr/bin/apt update\n    /usr/bin/apt -y install apache2-utils squid3\n}\n\nsquid_configuration() {\n    # Revove old squid.conf config\n    /bin/rm -f /etc/squid/squid.conf\n    /usr/bin/touch /etc/squid/blacklist.acl\n\n    # Update iptables and accept port\n    /sbin/iptables -I INPUT -p tcp --dport 3128 -j ACCEPT\n    /sbin/iptables-save\n\n    # Reset service\n    service squid restart\n    update-rc.d squid defaults\n}\n\npreinstall\nwhiptailMessageBox &quot;Info&quot; &quot;Auto installation script will guide you with configuration of squid package&quot;\nSQUID_USERNAME=$(whiptailInputBox &quot;Squid Username&quot; &quot;Provide SQUID username&quot; &quot;&quot;)\nif [ $? != 0 ]; then exit; fi\nSQUID_PASSWORD=$(whiptailPasswordBox &quot;Squid Password&quot; &quot;Provide SQUID password&quot; &quot;&quot;)\nif [ $? != 0 ]; then exit; fi\n\ninstall_squid\n/usr/bin/htpasswd -b -c /etc/squid/passwd $SQUID_USERNAME $SQUID_PASSWORD\nsquid_configuration\nwhiptailMessageBox &quot;Info&quot; &quot;Instalation complete&quot;</code></pre></div>\n<p>With squid already installed, we can go to configuration. The current <code class=\"language-text\">squid.conf</code> allows us only to use the proxy locally on the server. To unlock its external use, we must remember that each service published by us should be secured. There are too many IP lists of proxy servers on the Internet that have been exposed to the public with different port values in hope that no one will guess why they are open.</p>\n<p>To protect yourself against such situations, it is enough to unblock the proxy entry only for credentials that we created earlier using the script above. The record should be placed under the indicated comment in the <code class=\"language-text\">/etc/squid/squid.conf</code> file. After that, all you need it reset the service and you can connect to your proxy service.</p>\n<div class=\"gatsby-highlight\" data-language=\"dotenv\"><pre class=\"language-dotenv\"><code class=\"language-dotenv\">#\n# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS\n#\nauth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd\nauth_param basic children 5\nauth_param basic realm Squid Basic Authentication\nauth_param basic credentialsttl 2 hours\nacl auth_users proxy_auth REQUIRED\nhttp_access allow auth_users</code></pre></div>\n<h2 id=\"tips\" style=\"position:relative;\"><a href=\"#tips\" aria-label=\"tips permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tips</h2>\n<p>curl command can be used to test a connection through a proxy</p>\n<div class=\"gatsby-highlight\" data-language=\"bashscript\"><pre class=\"language-bashscript\"><code class=\"language-bashscript\">curl -x http://user.password@domain_or_IP:3128 -I http://google.com\n\n# When success (Message head)\nHTTP/1.1 301 Moved Permanently\nLocation: http://www.google.com/\n\n# When conection is secured with proxy (Message head)\nHTTP/1.1 407 Proxy Authentication Required</code></pre></div>\n<p>Likewise, we can get our IP after going through any proxy we provide</p>\n<div class=\"gatsby-highlight\" data-language=\"bashscript\"><pre class=\"language-bashscript\"><code class=\"language-bashscript\">wget -e use_proxy=yes -e http_proxy=http://user.password@domain_or_IP:3128 -qO- http://ipecho.net/plain | xargs echo</code></pre></div>","fields":{"slug":"/posts/magic-of-whiptail-squid-proxy-instalation","tagSlugs":["/tag/technology/","/tag/dev/","/tag/ops-dev-ops/"]},"frontmatter":{"date":"2020-11-04T21:50:47.000Z","description":"When installing a bash open source project, I was always full of admiration for the developers who implemented the graphical interface. I was curious how it works and how I could apply it to my projects. The solution is simple - whiptail","tags":["Technology","Dev","Ops / DevOps"],"title":"Magic of whiptail and Squid proxy installation","socialImage":"media/server-4.jpg"}}},"pageContext":{"slug":"/posts/magic-of-whiptail-squid-proxy-instalation"}},"staticQueryHashes":["1797451822","251939775","401334301"]}